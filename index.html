<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>ğŸ½ï¸ ì—°ì„¸ì„¸ë¸Œë€ìŠ¤ë¹Œë”© ì£¼ë³€ ë§›ì§‘</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      --bg1:#667eea; --bg2:#764ba2;
      --card:#ffffffF2; --ink:#2c3e50; --sub:#7f8c8d;
      --chip:#ecf0f1; --grad1:linear-gradient(135deg,var(--bg1),var(--bg2));
      --shadow:0 15px 35px rgba(0,0,0,.12);
      --shadow-lg:0 25px 50px rgba(0,0,0,.18)
    }
    body{font-family:system-ui,-apple-system,Pretendard,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      min-height:100vh;background:var(--grad1);color:var(--ink)}
    .container{max-width:1200px;margin:0 auto;padding:20px}
    .header,.panel{background:var(--card);border-radius:20px;box-shadow:var(--shadow)}
    .header{padding:30px;margin-bottom:20px;text-align:center}
    .header h1{font-size:2rem;margin-bottom:8px}
    .header p{color:var(--sub)}
    .toolbar{display:grid;grid-template-columns:1fr;gap:14px;margin-bottom:16px}
    .panel{padding:16px}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .filter-group{display:flex;flex-wrap:wrap;gap:8px}
    .chip{padding:10px 14px;border:none;border-radius:999px;background:#ecf0f1;color:var(--ink);
      font-weight:600;cursor:pointer;transition:.2s}
    .chip[aria-pressed="true"]{background:var(--bg1);color:#fff}
    .search{flex:1;min-width:220px;display:flex;gap:8px}
    .search input{flex:1;padding:12px;border:2px solid #ecf0f1;border-radius:12px}
    .search input:focus{outline:none;border-color:#667eea}
    select{padding:12px;border:2px solid #ecf0f1;border-radius:12px;min-width:180px}
    .actions{display:flex;flex-wrap:wrap;gap:10px}
    .btn{padding:12px 16px;border:none;border-radius:12px;color:#fff;font-weight:700;cursor:pointer;transition:.2s}
    .btn:hover{transform:translateY(-1px);box-shadow:var(--shadow)}
    .btn-primary{background:var(--bg1)}
    .btn-success{background:#10ac84}
    .btn-warn{background:#feca57;color:#2c3e50}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:18px;margin-top:14px}
    .card{background:var(--card);border-left:5px solid var(--bg1);border-radius:16px;padding:18px;box-shadow:var(--shadow);transition:.2s}
    .card:hover{transform:translateY(-3px);box-shadow:var(--shadow-lg)}
    .name{font-weight:800;font-size:1.2rem;margin-bottom:6px}
    .rowline{display:flex;gap:8px;align-items:center;margin:6px 0}
    .label{font-weight:700;color:var(--sub);min-width:54px}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;font-size:.8rem;font-weight:800;color:#fff}
    .korean{background:#e74c3c}.japanese{background:#f39c12}.chinese{background:#27ae60}.western{background:#3498db}.other{background:#9b59b6}
    .price{background:#34495e}
    .distance{color:#e67e22;font-weight:800}
    .links a{font-size:.9rem;text-decoration:underline;color:#334155}
    .random{display:none;background:linear-gradient(135deg,#feca57,#ff9ff3);color:#1f2937;padding:18px;border-radius:16px;margin-top:10px}
    .toast{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);background:#111827;color:#fff;
      padding:10px 14px;border-radius:10px;opacity:0;pointer-events:none;transition:.3s}
    .toast.show{opacity:1}
    /* Modal */
    dialog{border:none;border-radius:16px;box-shadow:var(--shadow-lg);max-width:520px;width:90%}
    dialog::backdrop{background:rgba(0,0,0,.45);backdrop-filter:blur(2px)}
    form .grp{margin-bottom:12px}
    form label{display:block;font-weight:700;margin-bottom:6px}
    form input,form select{width:100%;padding:12px;border:2px solid #ecf0f1;border-radius:12px}
    form input:focus,form select:focus{outline:none;border-color:#667eea}
    .submit{width:100%;padding:14px;background:var(--bg1);color:#fff;border:none;border-radius:12px;font-weight:800}
    @media (max-width:768px){
      .header h1{font-size:1.6rem}
      .grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header" role="banner">
      <h1>ğŸ½ï¸ ì—°ì„¸ì„¸ë¸Œë€ìŠ¤ë¹Œë”© ì£¼ë³€ ë§›ì§‘</h1>
      <p>ê²€ìƒ‰Â·í•„í„°Â·ì •ë ¬Â·ëœë¤ ì¶”ì²œê¹Œì§€ í•œ ë²ˆì—</p>
    </header>

    <section class="panel toolbar" aria-label="í•„í„°ì™€ ë„êµ¬">
      <div class="row" aria-label="ìŒì‹ ì¢…ë¥˜">
        <strong style="min-width:72px">ğŸœ ì¢…ë¥˜</strong>
        <div id="catFilters" class="filter-group" role="group" aria-label="ì¢…ë¥˜ í•„í„°">
          <!-- Chips are injected -->
        </div>
      </div>

      <div class="row" aria-label="ê°€ê²©ëŒ€">
        <strong style="min-width:72px">ğŸ’° ê°€ê²©</strong>
        <div id="priceFilters" class="filter-group" role="group" aria-label="ê°€ê²© í•„í„°"></div>
      </div>

      <div class="row">
        <div class="search" role="search">
          <input id="q" type="search" placeholder="ì‹ë‹¹ëª…Â·ë©”ë‰´ ê²€ìƒ‰ (ì˜ˆ: ëƒ‰ë©´/ìš°ë™/ì‚¼ê²¹ì‚´)" aria-label="ê²€ìƒ‰"/>
          <select id="sorter" aria-label="ì •ë ¬">
            <option value="distance.asc">ê±°ë¦¬ â†‘</option>
            <option value="price.asc">ê°€ê²© â†‘</option>
            <option value="price.desc">ê°€ê²© â†“</option>
            <option value="name.asc">ì´ë¦„ â†‘</option>
          </select>
        </div>
        <div class="actions" role="group" aria-label="ë„êµ¬">
          <button id="btnRandom" class="btn btn-warn" type="button">ğŸ² ëœë¤ ì¶”ì²œ</button>
          <button id="btnAdd" class="btn btn-success" type="button">â• ì‹ë‹¹ ì¶”ê°€</button>
          <button id="btnUpdate" class="btn btn-primary" type="button" title="ê°€ì§œ ì—…ë°ì´íŠ¸ ì‹œë®¬ë ˆì´ì…˜">ğŸ”„ ì—…ë°ì´íŠ¸</button>
        </div>
      </div>

      <div id="randomBox" class="random" role="status" aria-live="polite"></div>
    </section>

    <section class="panel">
      <div id="grid" class="grid" aria-live="polite" aria-busy="false"></div>
    </section>
  </div>

  <!-- Add Modal -->
  <dialog id="addDlg" aria-labelledby="addTitle">
    <form id="addForm" method="dialog">
      <h2 id="addTitle" style="margin-bottom:10px">ğŸª ìƒˆ ì‹ë‹¹ ì¶”ê°€</h2>
      <div class="grp">
        <label for="name">ì‹ë‹¹ ì´ë¦„</label>
        <input id="name" required maxlength="40" />
      </div>
      <div class="grp">
        <label for="menu">ì£¼ ë©”ë‰´</label>
        <input id="menu" required maxlength="40"/>
      </div>
      <div class="grp">
        <label for="cat">ìŒì‹ ì¢…ë¥˜</label>
        <select id="cat" required>
          <option value="">ì„ íƒí•˜ì„¸ìš”</option>
          <option value="korean">í•œì‹</option>
          <option value="japanese">ì¼ì‹</option>
          <option value="chinese">ì¤‘ì‹</option>
          <option value="western">ì–‘ì‹</option>
          <option value="other">ê¸°íƒ€</option>
        </select>
      </div>
      <div class="grp">
        <label for="price">í‰ê·  ê°€ê²©(ì›)</label>
        <input id="price" type="number" min="0" step="100" required />
      </div>
      <div class="grp">
        <label for="dist">ì—°ì„¸ì„¸ë¸Œë€ìŠ¤ë¹Œë”©ì—ì„œ ê±°ë¦¬(ë„ë³´ ë¶„)</label>
        <input id="dist" type="number" min="1" max="60" required />
      </div>
      <button class="submit" type="submit">ì‹ë‹¹ ì¶”ê°€í•˜ê¸°</button>
    </form>
  </dialog>

  <div id="toast" class="toast" role="status" aria-live="polite">ì™„ë£Œ</div>

  <script>
    // ---------- Utilities ----------
    const $ = (sel, root=document)=>root.querySelector(sel);
    const $$ = (sel, root=document)=>[...root.querySelectorAll(sel)];
    const toast = (msg)=>{ const t=$("#toast"); t.textContent=msg; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"),1400) };
    const clampInt = (v,min,max)=>Math.max(min,Math.min(max,Math.round(Number(v)||0)));
    const formatWon = n => (Number(n)||0).toLocaleString()+"ì›";
    const normalize = s => (s||"").toString().trim().toLowerCase();

    // ---------- Data ----------
    const seed = [
      {name:'ëª…ë™ì§‘',menu:'ê¸‰ëƒ‰ ì‚¼ê²¹ì‚´',category:'korean',price:15000,distance:5},
      {name:'ì„œìš¸ì—­ êµ¬ë‚´ì‹ë‹¹',menu:'í•œì‹ ì •ì‹',category:'korean',price:6500,distance:5},
      {name:'ì„œë¦¬ì¬',menu:'ì†¥ë°¥',category:'korean',price:12000,distance:5},
      {name:'í† ë¼ì •',menu:'í¬ë¦¼ ì¹´ë ˆ ìš°ë™',category:'japanese',price:11000,distance:5},
      {name:'ëˆ„ë“¤í‚¹',menu:'ìš°ë™',category:'japanese',price:9000,distance:5},
      {name:'ë”í”Œë ˆì´ìŠ¤',menu:'í­íƒ„í”¼ì',category:'western',price:18000,distance:7},
      {name:'ëˆìˆ˜ë°±',menu:'ë¼ì§€êµ­ë°¥',category:'korean',price:8000,distance:8},
      {name:'íˆ¬ë¿”ë“±ì‹¬',menu:'í•œìš° ë“±ì‹¬',category:'korean',price:35000,distance:7},
      {name:'í˜¸ìˆ˜ì§‘',menu:'ë‹­ê¼¬ì¹˜',category:'korean',price:13000,distance:10},
      {name:'í¬ë½ê°ˆì¹˜',menu:'ê°ˆì¹˜ì¡°ë¦¼',category:'korean',price:14000,distance:12},
      {name:'ì€í˜¸ì‹ë‹¹',menu:'ê¼¬ë¦¬ê³°íƒ•',category:'korean',price:17000,distance:12},
      {name:'ë§‰ë‚´íšŒì§‘',menu:'íšŒ',category:'korean',price:25000,distance:12},
      {name:'ê°€ë©”ê³¨ì†ì™•ë§Œë‘',menu:'ì™•ë§Œë‘',category:'chinese',price:9000,distance:12},
      {name:'êµ¬ë³µë§Œë‘',menu:'ì¤‘êµ­ì‹ ë§Œë‘',category:'chinese',price:10000,distance:12},
      {name:'ë¶€ì›ë©´ì˜¥',menu:'í‰ì–‘ëƒ‰ë©´',category:'korean',price:12000,distance:13},
      {name:'ì¶©ë¬´ì¹¼êµ­ìˆ˜',menu:'ì¹¼êµ­ìˆ˜',category:'korean',price:8000,distance:13},
      {name:'ë‹­ì§„ë¯¸ê°•ì›ì§‘',menu:'ë‹­ê³°íƒ•',category:'korean',price:11000,distance:12},
      {name:'í’ë…„ì˜¥',menu:'ì„¤ë íƒ•',category:'korean',price:10000,distance:13},
      {name:'ì˜ë‚¨ì§‘',menu:'ë‹­ê³°íƒ•',category:'korean',price:9500,distance:13},
      {name:'í˜ì´ì•¼ë“œ',menu:'ë””ì €íŠ¸',category:'other',price:8000,distance:12},
      {name:'ìœ ì¦ˆë¼ë©˜',menu:'ìœ ì¦ˆì‹œì˜¤ë¼ë©˜',category:'japanese',price:12000,distance:15},
      {name:'ë§Œë¦¬ì¬ ë¹„ìŠ¤íŠ¸ë¡œ',menu:'í™”ë•í”¼ì',category:'western',price:20000,distance:15},
      {name:'ê°ˆì›”ì´ê³¨ëª©',menu:'íŒŒìŠ¤íƒ€',category:'western',price:16000,distance:16},
      {name:'í¬ì»¬í¬ì¸íŠ¸',menu:'ë² ì´ì»¤ë¦¬',category:'other',price:7000,distance:15},
      {name:'íŒŒì´ë¸Œê°€ì´ì¦ˆ',menu:'ìˆ˜ì œë²„ê±°',category:'western',price:14000,distance:15},
      {name:'ì„ì§€ë©´ì˜¥',menu:'í‰ì–‘ëƒ‰ë©´',category:'korean',price:13000,distance:18},
      {name:'ì•ˆë™ì¥',menu:'ì§œì¥ë©´',category:'chinese',price:8000,distance:18},
      {name:'ê°œí™”',menu:'ì¤‘ì‹',category:'chinese',price:15000,distance:18},
      {name:'ì „ì£¼ì§‘',menu:'ì–‘ë…ê°ˆë¹„',category:'korean',price:22000,distance:18},
      {name:'ì„œìš¸ë¶€ë ë„',menu:'í“¨ì „ìš”ë¦¬',category:'other',price:25000,distance:16}
    ];
    const LS_KEY = "ys_sev_restaurants_v1";
    let restaurants = load();
    function load(){
      const saved = JSON.parse(localStorage.getItem(LS_KEY)||"[]");
      // merge by name (case-insensitive)
      const map = new Map();
      [...seed,...saved].forEach(r=>{
        const key = normalize(r.name);
        if(!map.has(key)) map.set(key,{...r});
      });
      return [...map.values()];
    }
    function persist(){
      // only persist items not in seed (by name)
      const seedSet = new Set(seed.map(s=>normalize(s.name)));
      const custom = restaurants.filter(r=>!seedSet.has(normalize(r.name)));
      localStorage.setItem(LS_KEY, JSON.stringify(custom));
    }

    // ---------- State ----------
    const catDef = [
      {val:"all", label:"ì „ì²´"},
      {val:"korean", label:"í•œì‹"},
      {val:"japanese", label:"ì¼ì‹"},
      {val:"chinese", label:"ì¤‘ì‹"},
      {val:"western", label:"ì–‘ì‹"},
      {val:"other", label:"ê¸°íƒ€"}
    ];
    const priceDef = [
      {val:"all", label:"ì „ì²´"},
      {val:"under10", label:"1ë§Œì› ì´í•˜"},
      {val:"10s", label:"1ë§Œì›ëŒ€"},
      {val:"20s", label:"2ë§Œì›ëŒ€"},
      {val:"over20", label:"2ë§Œì› ì´ìƒ"}
    ];
    const state = {
      category:"all",
      price:"all",
      query:"",
      sort:"distance.asc"
    };

    // ---------- UI Build ----------
    function buildChips(container, items, group){
      container.innerHTML = items.map((it,i)=>(
        `<button class="chip" type="button" data-group="${group}" data-val="${it.val}"
          aria-pressed="${i===0?'true':'false'}">${it.label}</button>`
      )).join("");
    }
    buildChips($("#catFilters"), catDef, "cat");
    buildChips($("#priceFilters"), priceDef, "price");

    // ---------- Filtering / Sorting ----------
    const inPriceRange = (p, rng)=>{
      switch(rng){
        case "under10": return p < 10000;
        case "10s": return p>=10000 && p<20000;
        case "20s": return p>=20000 && p<30000;
        case "over20": return p>=30000;
        default: return true;
      }
    };
    const catName = c => ({korean:"í•œì‹",japanese:"ì¼ì‹",chinese:"ì¤‘ì‹",western:"ì–‘ì‹",other:"ê¸°íƒ€"})[c]||c;
    function applyFilters(){
      const qn = normalize(state.query);
      let list = restaurants.filter(r=>{
        const catOk = state.category==="all" || r.category===state.category;
        const priceOk = state.price==="all" || inPriceRange(r.price,state.price);
        const qOk = !qn || normalize(r.name).includes(qn) || normalize(r.menu).includes(qn);
        return catOk && priceOk && qOk;
      });
      const [key,dir] = state.sort.split(".");
      list.sort((a,b)=>{
        const mk = {
          distance:(x)=>x.distance,
          price:(x)=>x.price,
          name:(x)=>normalize(x.name)
        }[key];
        const av = mk(a), bv = mk(b);
        if(av<bv) return dir==="asc"?-1:1;
        if(av>bv) return dir==="asc"?1:-1;
        return 0;
      });
      return list;
    }

    // ---------- Render ----------
    function mapLink(name){
      const q = encodeURIComponent(name);
      const origin = encodeURIComponent("ì—°ì„¸ì„¸ë¸Œë€ìŠ¤ë¹Œë”©");
      return {
        search:`https://m.map.naver.com/search2/search.naver?query=${q}`,
        route:`https://map.naver.com/v5/directions/-/-/${q}?c=14134377,4518501,15,0,0,0,dh`
        // Note: mobile/PC will handle formats; origin text shown in UI only
      };
    }
    function render(){
      $("#grid").setAttribute("aria-busy","true");
      const list = applyFilters();
      $("#grid").innerHTML = list.map(r=>{
        const links = mapLink(r.name);
        return `
        <article class="card" tabindex="0">
          <div class="name">${r.name}</div>
          <div class="rowline"><span class="label">ë©”ë‰´</span><span>${r.menu}</span></div>
          <div class="rowline"><span class="label">ì¢…ë¥˜</span><span class="badge ${r.category}">${catName(r.category)}</span></div>
          <div class="rowline"><span class="label">ê°€ê²©</span><span class="badge price">${formatWon(r.price)}</span></div>
          <div class="rowline"><span class="label">ê±°ë¦¬</span><span class="distance">ğŸš¶ ${r.distance}ë¶„</span></div>
          <div class="rowline links" style="gap:14px">
            <a href="${links.search}" target="_blank" rel="noopener">ë„¤ì´ë²„ ì§€ë„ ê²€ìƒ‰</a>
            <a href="${links.route}" target="_blank" rel="noopener">ê¸¸ì°¾ê¸°(ì¶œë°œ: ì—°ì„¸ì„¸ë¸Œë€ìŠ¤ë¹Œë”©)</a>
          </div>
        </article>`;
      }).join("") || `<div style="padding:16px">ì¡°ê±´ì— ë§ëŠ” ì‹ë‹¹ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
      $("#grid").setAttribute("aria-busy","false");
      return list;
    }
    render();

    // ---------- Events ----------
    // filter chips
    $("#catFilters").addEventListener("click",(e)=>{
      const btn = e.target.closest(".chip"); if(!btn) return;
      $$("#catFilters .chip").forEach(b=>b.setAttribute("aria-pressed","false"));
      btn.setAttribute("aria-pressed","true");
      state.category = btn.dataset.val;
      render();
    });
    $("#priceFilters").addEventListener("click",(e)=>{
      const btn = e.target.closest(".chip"); if(!btn) return;
      $$("#priceFilters .chip").forEach(b=>b.setAttribute("aria-pressed","false"));
      btn.setAttribute("aria-pressed","true");
      state.price = btn.dataset.val;
      render();
    });

    // search (debounced)
    let tId;
    $("#q").addEventListener("input",(e)=>{
      clearTimeout(tId);
      tId = setTimeout(()=>{ state.query = e.target.value; render(); }, 180);
    });

    // sorter
    $("#sorter").addEventListener("change",(e)=>{
      state.sort = e.target.value;
      render();
    });

    // random recommendation
    $("#btnRandom").addEventListener("click",()=>{
      const list = applyFilters();
      if(list.length===0){ toast("ì¡°ê±´ì— ë§ëŠ” ì‹ë‹¹ì´ ì—†ì–´ìš”"); $("#randomBox").style.display="none"; return; }
      const pick = list[Math.floor(Math.random()*list.length)];
      $("#randomBox").innerHTML = `
        <div><strong>ğŸ¯ ì˜¤ëŠ˜ì˜ ì¶”ì²œ</strong></div>
        <div style="margin-top:6px">
          <div style="font-size:1.1rem;font-weight:800">${pick.name}</div>
          <div>ğŸ½ï¸ ${pick.menu} Â· ğŸ·ï¸ ${catName(pick.category)} Â· ğŸ’° ${formatWon(pick.price)} Â· ğŸš¶ ${pick.distance}ë¶„</div>
        </div>`;
      $("#randomBox").style.display="block";
      $("#randomBox").scrollIntoView({behavior:"smooth",block:"center"});
    });

    // fake update (simulate API)
    $("#btnUpdate").addEventListener("click",async()=>{
      toast("ì—…ë°ì´íŠ¸ ì¤‘â€¦");
      await new Promise(r=>setTimeout(r,600));
      const incoming = [
        {name:"ìƒˆë¡œìš´ ë§›ì§‘ 1",menu:"íŠ¹ì œ ë®ë°¥",category:"korean",price:12000,distance:8},
        {name:"ìƒˆë¡œìš´ ë§›ì§‘ 2",menu:"ë¼ë©˜",category:"japanese",price:13000,distance:10}
      ];
      let added=0;
      incoming.forEach(n=>{
        if(!restaurants.some(r=>normalize(r.name)===normalize(n.name))){
          restaurants.push(n); added++;
        }
      });
      if(added>0){ persist(); render(); }
      toast(`${added}ê°œ ì—…ë°ì´íŠ¸ ì™„ë£Œ`);
    });

    // add dialog
    const dlg = $("#addDlg");
    $("#btnAdd").addEventListener("click",()=>dlg.showModal());
    $("#addForm").addEventListener("submit",(e)=>{
      e.preventDefault();
      const name = $("#name").value;
      const menu = $("#menu").value;
      const category = $("#cat").value;
      const price = clampInt($("#price").value,0,1_000_000);
      const distance = clampInt($("#dist").value,1,120);

      if(!name||!menu||!category){ toast("ì…ë ¥ê°’ì„ í™•ì¸í•˜ì„¸ìš”"); return; }
      // duplication by name (ignore case/space)
      const key = normalize(name);
      if(restaurants.some(r=>normalize(r.name)===key)){
        toast("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‹ë‹¹ì…ë‹ˆë‹¤"); return;
      }
      restaurants.push({name:name.trim(),menu:menu.trim(),category,price,distance});
      persist();
      render();
      dlg.close();
      e.target.reset();
      toast("ìƒˆ ì‹ë‹¹ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤");
    });
    // close dialog on backdrop click (native supported); Esc closes automatically

    // keyboard: press / to focus search
    window.addEventListener("keydown",(e)=>{
      if(e.key==="/" && document.activeElement!==$("#q")){
        e.preventDefault(); $("#q").focus();
      }
    });
  </script>
</body>
</html>
